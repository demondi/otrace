<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1   Using otrace with the Tornado web server &mdash; otrace 0.30.9 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.30.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="otrace 0.30.9 documentation" href="index.html" />
    <link rel="prev" title="1   Getting started with otrace and oshell" href="GettingStarted.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35342722-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body role="document">
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle">
          <a href="http://code.mitotic.org">code.mitotic.org</a>/<a href="index.html">otrace</a>
        </div>
        <div class="rel">
          <a href="GettingStarted.html" title="1   Getting started with otrace and oshell"
             accesskey="P">previous</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
      </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-otrace-with-the-tornado-web-server">
<h1><a class="toc-backref" href="#id1">1&nbsp;&nbsp;&nbsp;Using <em>otrace</em> with the Tornado web server</a><a class="headerlink" href="#using-otrace-with-the-tornado-web-server" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#using-otrace-with-the-tornado-web-server" id="id1">1&nbsp;&nbsp;&nbsp;Using <em>otrace</em> with the Tornado web server</a><ul class="auto-toc">
<li><a class="reference internal" href="#setup" id="id2">1.1&nbsp;&nbsp;&nbsp;Setup</a></li>
<li><a class="reference internal" href="#holds" id="id3">1.2&nbsp;&nbsp;&nbsp;Holds</a></li>
<li><a class="reference internal" href="#osh-web" id="id4">1.3&nbsp;&nbsp;&nbsp;/osh/web</a></li>
</ul>
</li>
</ul>
</div>
<p>This brief tutorial illustrates the use of <em>otrace</em> with the asynchronous
Tornado web server using the demo program, <code class="docutils literal"><span class="pre">tornademos/torna_trace.py</span></code>,
included in the distribution. It is assumed that Tornado is installed
in the system (or in the <code class="docutils literal"><span class="pre">tornademos</span></code> directory).</p>
<div class="section" id="setup">
<h2><a class="toc-backref" href="#id2">1.1&nbsp;&nbsp;&nbsp;Setup</a><a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>For use with Tornado, <em>otrace</em> requires a couple of additional
options, <code class="docutils literal"><span class="pre">hold_wrapper</span></code> and <code class="docutils literal"><span class="pre">eventloop_callback</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Initialize OShell instance (to run on separate thread)</span>
<span class="n">IO_loop</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="n">trace_shell</span> <span class="o">=</span> <span class="n">OShell</span><span class="p">(</span><span class="n">locals_dict</span><span class="o">=</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">globals_dict</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">allow_unsafe</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">init_file</span><span class="o">=</span><span class="s">&quot;torna_trace.trc&quot;</span><span class="p">,</span> <span class="n">new_thread</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">hold_wrapper</span><span class="o">=</span><span class="n">tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">Task</span><span class="p">,</span>
                     <span class="n">eventloop_callback</span><span class="o">=</span><span class="n">IO_loop</span><span class="o">.</span><span class="n">add_callback</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># Start oshell</span>
    <span class="n">trace_shell</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

    <span class="c"># Start tornado event loop</span>
    <span class="n">IO_loop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">trace_shell</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="holds">
<h2><a class="toc-backref" href="#id3">1.2&nbsp;&nbsp;&nbsp;Holds</a><a class="headerlink" href="#holds" title="Permalink to this headline">¶</a></h2>
<p>Since Tornado is a single-threaded asynchronous server, breakpoints
would halt the server. However, using the asynchronous request
handling supported by Tornado, one can <em>hold</em> the execution of a
single request using a statement of the form:</p>
<div class="highlight-python"><div class="highlight"><pre>@tornado.web.asynchronous
@tornado.gen.engine
...
yield traceassert(number != &quot;77&quot;, label=&quot;hold_check&quot;, action=&quot;hold&quot;)
</pre></div>
</div>
<p>instead of setting a breakpoint. The <em>hold</em> trace event occurs
when the trace condition is false. The <code class="docutils literal"><span class="pre">resume</span></code> command is used
to resume execution from a hold. Here&#8217;s an example where a hold
is triggered when a user enters the number <em>77</em> in the form:</p>
<div class="highlight-python"><div class="highlight"><pre>tornademos$ ./torna_trace.py
Listening on port 8888
  ***otrace object shell (v0.30)*** (type &#39;help&#39; for info)
globals&gt; set trace_active True
trace_active = True
&gt; rootW path=/?number=1
rootW path=/?number=77
GetHandler.get:hd-hold_check:21-06-24
&gt; ls ~~
/osh/recent/holds/GetHandler.get/hd-hold_check/21-06-24
&gt; cd ~~
GetHandler..06-24&gt; ls
__down __trc  number self
GetHandler..06-24&gt; ls -l
__down = {__trc, __down, __up}
__trc  = {thread, framestack, frame, related, funcname, context, argvalues, where, id, argstr}
number = u&#39;77&#39;
self   = &lt;__main__.GetHandler object at 0x10ac0d950&gt;
GetHandler..06-24&gt; resume
globals&gt;
</pre></div>
</div>
<p>Note that we need to activate tracing explicitly by setting parameter
<code class="docutils literal"><span class="pre">trace_active</span></code> to True to trace <code class="docutils literal"><span class="pre">traceassert</span></code> calls. (This step is
not needed when the <code class="docutils literal"><span class="pre">trace</span></code> command is used for tracing, because
tracing is automatically activated.)</p>
</div>
<div class="section" id="osh-web">
<h2><a class="toc-backref" href="#id4">1.3&nbsp;&nbsp;&nbsp;/osh/web</a><a class="headerlink" href="#osh-web" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">/osh/web</span></code> feature, used with Websockets and
some Javascript &#8220;glue code&#8221;, allows the <em>otrace</em> server console
to execute arbitrary Javacript commands on the client-side browser.
The demo program <code class="docutils literal"><span class="pre">tornademos/chat_websock.py</span></code> is a modified version
of the chat demo program distributed with Tornado, using websockets.
If you run the program, and have one or more users chatting, you can
execute javascript commands in any user&#8217;s browser via the
<code class="docutils literal"><span class="pre">/osh/web/username</span></code> directory:</p>
<div class="highlight-python"><div class="highlight"><pre>tornademos$ ./chat_websock.py
chat_websock: Listening on 127.0.0.1:8888
  ***otrace object shell (v0.30)*** (type &#39;help&#39; for info)
&gt; cd /osh/web
web&gt; ls
user1
web&gt; set safe_mode False
safe_mode = False
web&gt; cd user1
web..user1&gt; $(&quot;body&quot;)
[object Object]
web..user1&gt; $(&quot;body&quot;).css(&quot;background&quot;,&quot;red&quot;) // Change background to red
[object Object]
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">chat_websock.py</span></code>, user input is handled by the input element
with id <em>message</em>.
The <code class="docutils literal"><span class="pre">repeat</span></code> command can be used to monitor user&#8217;s typing in real time:</p>
<div class="highlight-python"><div class="highlight"><pre>web..user1&gt; $(&quot;#message&quot;)
[object Object]
web..user1&gt; repeat &quot;User is typing: &quot;+$(&quot;#message&quot;).val()
</pre></div>
</div>
<p><em>Last modified:</em> 2016-03-31</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting started with OTrace</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Using OTrace with Tornado</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/mitotic/otrace">Source code at Github</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/otrace">Download from PyPI package index</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>


    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="GettingStarted.html" title="1   Getting started with otrace and oshell"
              >previous</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, R. Saravanan.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>